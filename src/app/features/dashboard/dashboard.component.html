<div class="grid p-fluid">
    <div class="general-summary col-12">
        <div class="grid">
            <div class="col-12 md:col-6 pb-0">
                <div class="card mb-0">
                    <app-chat-main></app-chat-main>
                </div>
            </div>
            <div class="col-12 md:col-6 pb-0">
                <ng-container *ngIf="!(isLoading$ | async); else chartsSkeleton">
                    <div class="grid">
                        <div class="col-12 lg:col-6">
                            <app-dashboard-charts header="Proyectos por Línea de Acción" type="doughnut" [data]="chartData1" [options]="chartOptions1"></app-dashboard-charts>
                        </div>
                        <div class="col-12 lg:col-6">
                            <app-dashboard-charts header="Proyectos por Estado" type="bar" [data]="chartData2" [options]="chartOptions2"></app-dashboard-charts>
                        </div>
                        <div class="col-12 lg:col-6">
                            <app-dashboard-charts header="Ejecución Física Global" type="doughnut" [data]="chartData3" [options]="chartOptions3"></app-dashboard-charts>
                        </div>
                    </div>
                </ng-container>

                <ng-template #chartsSkeleton>
                    <div class="grid">
                        <div class="col-12 lg:col-6">
                            <div class="card h-full flex flex-column justify-content-center align-items-center p-3">
                                <p-skeleton width="12rem" height="1.5rem" styleClass="mb-3"></p-skeleton>
                                <p-skeleton shape="circle" size="140px"></p-skeleton>
                            </div>
                        </div>
                        <div class="col-12 lg:col-6">
                            <div class="card h-full flex flex-column justify-content-center align-items-center p-3">
                                <p-skeleton width="10rem" height="1.5rem" styleClass="mb-3"></p-skeleton>
                                <p-skeleton width="90%" height="140px"></p-skeleton>
                            </div>
                        </div>
                        <div class="col-12 lg:col-6">
                            <div class="card h-full flex flex-column justify-content-center align-items-center p-3">
                                <p-skeleton width="11rem" height="1.5rem" styleClass="mb-3"></p-skeleton>
                                <p-skeleton shape="circle" size="140px"></p-skeleton>
                            </div>
                        </div>
                    </div>
                </ng-template>
            </div>
        </div>
    </div>

    <div #stickyObserver></div>

    <div class="col-12 sticky top-0 z-5 section-filters" [ngClass]="{'is-scrolled': isStickyActive}">

        <app-dashboard-filters [options]="filterOptions$ | async" (filtersChanged)="onFiltersChanged($event)"></app-dashboard-filters>

        <ng-container *ngIf="!(isLoading$ | async); else summarySkeleton">
            <app-dashboard-summary [summary]="summary$ | async"></app-dashboard-summary>
        </ng-container>

        <ng-template #summarySkeleton>
            <div class="grid summary-grid">
                <div class="col-12 md:col-3">
                    <div class="card p-3">
                        <p-skeleton width="8rem" height="1rem" styleClass="mb-2"></p-skeleton>
                        <div class="flex align-items-center">
                            <p-skeleton shape="circle" size="3rem" styleClass="mr-3"></p-skeleton>
                            <p-skeleton width="5rem" height="2rem"></p-skeleton>
                        </div>
                    </div>
                </div>
                <div class="col-12 md:col-3">
                    <div class="card p-3">
                        <p-skeleton width="10rem" height="1rem" styleClass="mb-2"></p-skeleton>
                        <div class="flex align-items-center">
                            <p-skeleton shape="circle" size="3rem" styleClass="mr-3"></p-skeleton>
                            <p-skeleton width="6rem" height="2rem"></p-skeleton>
                        </div>
                    </div>
                </div>
                <div class="col-12 md:col-3 px-0 md:px-2">
                    <div class="card p-3">
                        <p-skeleton width="7rem" height="1rem" styleClass="mb-2"></p-skeleton>
                        <div class="flex align-items-center">
                            <p-skeleton shape="circle" size="3rem" styleClass="mr-3"></p-skeleton>
                            <p-skeleton width="4rem" height="2rem"></p-skeleton>
                        </div>
                    </div>
                </div>
                <div class="col-12 md:col-3">
                    <div class="card p-3">
                        <p-skeleton width="9rem" height="1rem" styleClass="mb-2"></p-skeleton>
                        <div class="flex align-items-center">
                            <p-skeleton shape="circle" size="3rem" styleClass="mr-3"></p-skeleton>
                            <p-skeleton width="6rem" height="2rem"></p-skeleton>
                        </div>
                    </div>
                </div>
            </div>
        </ng-template>

        <div class="col-12 py-0 px-0">
            <div class="p-0 flex flex-wrap justify-content-between align-items-center mb-0">
                <div class="flex flex-wrap gap-2">
                    <p-button label="Todos" (onClick)="setActiveProjectFilter('all')" [styleClass]="activeProjectFilter === 'all' ? '' : 'p-button-outlined'"></p-button>
                    <p-button label="Mis proyectos" (onClick)="setActiveProjectFilter('myProjects')" [styleClass]="activeProjectFilter === 'myProjects' ? '' : 'p-button-outlined'"></p-button>
                    <p-button label="Favoritos" (onClick)="setActiveProjectFilter('favorites')" [styleClass]="activeProjectFilter === 'favorites' ? '' : 'p-button-outlined'"></p-button>
                </div>

                <div class="flex flex-wrap gap-2">
                    <p-button icon="pi pi-table" (onClick)="changeLayout('split')" [styleClass]="layoutView === 'split' ? '' : 'p-button-outlined'"></p-button>
                    <p-button icon="pi pi-th-large" (onClick)="changeLayout('grid')" [styleClass]="layoutView === 'grid' ? '' : 'p-button-outlined'"></p-button>
                    <p-button icon="pi pi-bars" (onClick)="changeLayout('list')" [styleClass]="layoutView === 'list' ? '' : 'p-button-outlined'"></p-button>
                    <p-button icon="pi pi-map-marker" (onClick)="changeLayout('map')" [styleClass]="layoutView === 'map' ? '' : 'p-button-outlined'"></p-button>
                </div>
            </div>
        </div>
    </div>

    <div class="col-12 pt-0 z-1">
        <div *ngIf="isLoading$ | async">

            <div *ngIf="layoutView === 'split'">
                <div class="grid">
                    <div class="col-12 md:col-7">
                        <div class="grid">
                            <div *ngFor="let i of projectsSkeletons" class="col-12 lg:col-4">
                                <app-project-card-skeleton></app-project-card-skeleton>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 md:col-5">
                        <p-skeleton width="100%" height="calc(100vh - 120px)"></p-skeleton>
                    </div>
                </div>
            </div>

            <div *ngIf="layoutView === 'grid'">
                <div class="grid">
                    <div *ngFor="let i of projectsSkeletons" class="col-12 md:col-6 lg:col-3">
                        <app-project-card-skeleton></app-project-card-skeleton>
                    </div>
                </div>
            </div>

            <div *ngIf="layoutView === 'list'">
                <div class="card">
                    <div class="flex justify-content-end p-4 border-bottom-1 surface-border">
                        <p-skeleton width="12rem" height="2.5rem"></p-skeleton>
                    </div>
                    <div *ngFor="let i of projectsSkeletons">
                        <app-project-list-item-skeleton></app-project-list-item-skeleton>
                    </div>
                </div>
            </div>

            <div *ngIf="layoutView === 'map'">
                <p-skeleton width="100%" height="calc(100vh - 120px)"></p-skeleton>
            </div>
        </div>

        <ng-container *ngIf="!(isLoading$ | async)">
            <ng-container *ngIf="filteredProjects$ | async as projects">
                <app-project-grid *ngIf="layoutView === 'grid'" [projects]="projects" [columnClass]="'lg:col-3'"></app-project-grid>
                <app-project-list *ngIf="layoutView === 'list'" [projects]="projects"></app-project-list>
                <app-project-split *ngIf="layoutView === 'split'" [projects]="projects"></app-project-split>
                <app-project-map *ngIf="layoutView === 'map'" [projects]="projects"></app-project-map>
            </ng-container>
        </ng-container>
    </div>
</div>