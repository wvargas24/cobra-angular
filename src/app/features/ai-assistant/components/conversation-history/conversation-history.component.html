<div class="conversation-history-container flex flex-column overflow-hidden">
    <div *ngIf="isLoadingConversations" class="flex justify-content-center align-items-center h-full">
        Loading...
    </div>

    <div *ngIf="!isLoadingConversations && conversations.length === 0" class="flex justify-content-center align-items-center h-full">
        <span>No conversations found.</span>
    </div>

    <div class="flex-grow-1 history-list overflow-y-auto" *ngIf="conversations.length > 0">
        <ul class="list-none p-0 m-0">
            <li *ngFor="let conversation of conversations" class="flex align-items-center py-2 px-1 surface-border border-round-xl mb-2 cursor-pointer"
                [ngClass]="{'bg-primary text-white': activeConversationThreadId === conversation.thread}" (click)="selectConversation(conversation)">

                <p-avatar icon="bx bx-message-detail" styleClass="mr-2" shape="circle"></p-avatar>

                <div class="flex-grow-1 overflow-hidden text-overflow-ellipsis white-space-nowrap">
                    <p class="font-bold mb-0 text-overflow-ellipsis white-space-nowrap" [title]="conversation.threadname">
                        {{ conversation.threadname || conversation.thread }}
                    </p>
                    <small class="" [ngClass]="{'text-white-alpha-70': activeConversationThreadId === conversation.thread}">
                        {{ conversation.createdAt | date: 'medium' }}
                    </small>
                </div>

                <button pButton type="button" icon="pi pi-ellipsis-v" class="p-button-rounded p-button-text p-button-sm ml-2" [ngClass]="{'text-white': activeConversationThreadId === conversation.thread}"
                        (click)="onMenuClick($event, conversation, menu); $event.stopPropagation();">
                </button>
                <p-menu #menu [model]="conversationMenuItems" [popup]="true"></p-menu>
            </li>
        </ul>
    </div>
</div>

<p-dialog header="Delete Conversation" [(visible)]="displayConfirmDialog" [modal]="true" [style]="{width: '30vw'}">
    <div class="flex align-items-center">
        <i class="pi pi-exclamation-triangle text-xl text-yellow-500 mr-3"></i>
        <span class="text-lg">Are you sure you want to delete this conversation?</span>
    </div>
    <ng-template pTemplate="footer">
        <p-button label="Cancel" icon="pi pi-times" styleClass="p-button-text" (click)="cancelDelete()"></p-button>
        <p-button label="Yes, delete" icon="pi pi-check" styleClass="p-button-danger" (click)="deleteConversation()"></p-button>
    </ng-template>
</p-dialog>